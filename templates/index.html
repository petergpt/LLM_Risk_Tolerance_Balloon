{% extends 'layout.html' %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">BART Experiment for Large Language Models</h2>
            </div>
            <div class="card-body">
                <p class="lead">
                    The Balloon Analogue Risk Task (BART) is a computerized measure of risk-taking behavior. 
                    In this implementation, we test how language models respond to risk scenarios.
                </p>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="balloon-container">
                            <svg class="balloon-svg {% if running %}balloon-animate{% endif %}" viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <radialGradient id="balloonGradient" cx="50%" cy="40%" r="50%" fx="50%" fy="40%">
                                        <stop offset="0%" stop-color="#ff7675" />
                                        <stop offset="100%" stop-color="#d63031" />
                                    </radialGradient>
                                </defs>
                                <!-- Balloon string -->
                                <path d="M50,140 Q50,120 50,100" stroke="#333" stroke-width="1.5" fill="none" />
                                <!-- Balloon -->
                                <ellipse cx="50" cy="50" rx="40" ry="45" fill="url(#balloonGradient)" />
                                <!-- Highlight -->
                                <ellipse cx="35" cy="35" rx="10" ry="12" fill="#ffffff" fill-opacity="0.3" />
                                <!-- Knot at bottom -->
                                <circle cx="50" cy="95" r="5" fill="#d63031" />
                            </svg>
                            <div class="mt-3">
                                <h4>How it works:</h4>
                                <ul class="text-start">
                                    <li>The model is presented with a balloon it can pump</li>
                                    <li>Each pump earns money but increases burst risk</li>
                                    <li>If the balloon bursts, all earnings for that balloon are lost</li>
                                    <li>The model must decide when to cash out</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h4 class="mb-0">Experiment Configuration</h4>
                            </div>
                            <div class="card-body">
                                {% if running %}
                                    <div class="alert alert-info">
                                        <i class="fas fa-spinner fa-spin"></i> Experiment is currently running...
                                    </div>
                                    <a href="{{ url_for('results') }}" class="btn btn-primary">View Results</a>
                                {% else %}
                                    <form class="experiment-form" method="POST" action="{{ url_for('index') }}">
                                        <div class="mb-3">
                                            <label for="model" class="form-label">Model</label>
                                            <input type="text" class="form-control" id="model" name="model" 
                                                   value="{{ config.get('model', 'openai/gpt-4o') }}"
                                                   placeholder="e.g., openai/gpt-4o, anthropic/claude-2">
                                            <div class="form-text">The OpenRouter model identifier to use</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="api_key" class="form-label">OpenRouter API Key</label>
                                            <input type="password" class="form-control" id="api_key" name="api_key" 
                                                   placeholder="sk-or-..." value="{{ config.get('openrouter_api_key', '') }}">
                                            <div class="form-text">Your OpenRouter API key (sk-or-...)</div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="min_pumps" class="form-label">Min Pumps</label>
                                                    <input type="number" class="form-control" id="min_pumps" name="min_pumps" 
                                                           value="{{ config.get('min_pumps', 1) }}" min="1" max="100">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="max_pumps" class="form-label">Max Pumps</label>
                                                    <input type="number" class="form-control" id="max_pumps" name="max_pumps" 
                                                           value="{{ config.get('max_pumps', 20) }}" min="1" max="100">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="reward_per_pump" class="form-label">Reward Per Pump ($)</label>
                                                    <input type="number" class="form-control" id="reward_per_pump" name="reward_per_pump" 
                                                           value="{{ config.get('reward_per_pump', 0.10) }}" step="0.01" min="0.01" max="10">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="num_balloons" class="form-label">Number of Balloons</label>
                                                    <input type="number" class="form-control" id="num_balloons" name="num_balloons" 
                                                           value="{{ config.get('num_balloons', 5) }}" min="1" max="100">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-play"></i> Start Experiment
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
